<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="../style.css">
<title>design de apis</title>
</head>
<body>

<section class="main">
    <h1>design de apis</h1>
    <h2>workshop bitcake 2022</h2>

    <footer>
        <p>por @ahvamolessa</p>
    </footer>
</section>

<section style="background-image: url(thinker.jpg)">
    <h1><em>api</em> √© apresentar <em>abstra√ß√µes</em> atrav√©s de uma <em>interface</em></h1>
</section>

<section>
    <h1>por que interfaces?</h1>
</section>

<section style="background-image: url(imagination.jpg)">
    <h1>abstra√ß√µes</h1>
</section>

<section style="background-image: url(complexity.jpg)">
    <h1>√© um modelo com o prop√≥sito de interpretar uma realidade rica em detalhes</h1>
    <h2>alcan√ßado por introduzir conceitos pertinentes ao dom√≠nio</h2>
</section>

<section style="background-image: url(faca-dois-legumes.jpg)">
    <h1>abstrair = faca de dois legumes</h1>
    <h2>esconder complexidade <em>adiciona</em> complexidade</h2>
</section>

<section>
    <h1>abstrair != remover complexidade</h1>
    <h2>esconder significa que ainda est√° l√°</h2>
</section>

<section>
    <h1>problemas complexos s√£o complexos</h1>
    <p>a √∫nica maneira de simplificar um problema inerenentemente complexo √© resolvendo outro problema (que seja mais simples)</p>
</section>

<section>
    <h2>escrever mais c√≥digo que o necess√°rio <em>por defini√ß√£o</em> apenas aumenta a complexidade da solu√ß√£o</h2>

    <footer>
        <p><a href="http://number-none.com/blow/john_carmack_on_inlined_code.html">john carmack on inlined code</a></p>
    </footer>
</section>

<section>
    <h1>complexidade inerente vs complexidade acidental</h1>
    <h2>inerente</h2>
    <ul>
    <li>propriedades fundamentais do problema</li>
    <li>√∫nica maneira de reduzi-la √© mudando o problema (e tudo bem!)</li>
    </ul>
    <h2>acidental</h2>
    <ul>
    <li>adicionada por n√≥s mesmos</li>
    <li>idealmente zero</li>
    <li>limita√ß√µes (linguagem, plataforma, design)</li>
    </ul>
</section>

<section>
    <h1>como saber qual complexidade estamos introduzindo?</h1>
    <ul>
    <li>entender o problema</li>
    <li>prototipa√ß√£o</li>
    <li>testar solu√ß√µes diferentes. refatorar</li>
    <li>evitar grandes solu√ß√µes gen√©ricas</li>
    <li>evitar future proofing ("fool's errand")</li>
    </ul>
    <p>erros e limita√ß√µes ser√£o encontrados independente da quantidade de design investido a priori. aceite-os e planeje-se!</p>

    <footer>
        <p><a href="https://ourmachinery.com/post/dig-shallow-graves/">dig shallow graves</a></p>
        <p><a href="https://docs.godotengine.org/en/stable/community/contributing/best_practices_for_engine_contributors.html">best practices for godot engine contributors</a></p>
    </footer>
</section>

<section>
    <h1>c√≥digo reutiliz√°vel vs c√≥digo f√°cil de deletar</h1>
    <h2>a √∫nica forma de criar c√≥digo reutiliz√°vel √© extraindo-o de c√≥digo f√°cil de deletar</h2>

    <footer>
        <p><a href="https://caseymuratori.com/blog_0015">semantic compression</a></p>
        <p><a href="https://programmingisterrible.com/post/139222674273/how-to-write-disposable-code-in-large-systems">how to write disposable code in large systems</a></p>
    </footer>
</section>

<section>
    <h1>apesar de tudo, abstra√ß√µes vazam</h1>
    <h2>sem exce√ß√£o</h2>

    <footer>
        <p><a href="https://www.youtube.com/watch?v=5l2wMgm7ZOk">why black boxes are so hard to reuse</a></p>
    </footer>
</section>

<section>
    <h1>abstra√ß√µes apenas t√™m valor quando levantam seu pr√≥prio peso</h1>
    <h2>"programmers know the benefits of everything and the tradeoffs of nothing"</h2>

    <footer>
        <p><a href="https://www.youtube.com/watch?v=rHIkrotSwcc&list=LLkSsu_JvG53vwdMNEDCLLqQ">there are no zero-cost abstractions</a></p>
        <p><a href="https://www.youtube.com/watch?v=rI8tNMsozo0">simplicity matters</a></p>
    </footer>
</section>

<section>
    <h1>apis e abstra√ß√µes <em>n√£o</em> existem no v√°cuo</h1>
    <ul>
    <li>o que: abstra√ß√µes</li>
    <li>inten√ß√£o de uso: interface</li>
    <li>quem usa: comunica√ß√£o</li>
    <li>restri√ß√µes: linguagem, plataforma, in√©rcia dos c√≥digos j√° existentes</li>
    </ul>

    <footer>
        <p><a href="https://cellperformance.beyond3d.com/articles/2006/04/performance-and-good-data-design.html">performance and good data design</a></p>
        <p><a href="https://quuxplusone.github.io/blog/2022/06/23/unordered-multiset-equal-range/">c++: unordered_multiset's api affects its big-o</a></p>
    </footer>
</section>

<section class="main">
    <h1>uma api √© boa se ela √© <em>profunda</em> e possui <em>interface enxuta</em></h1>

    <footer>
        <p><a href="https://www.youtube.com/watch?v=bmSAYlu0NcY">a philosophy of software design</a></p>
    </footer>
</section>

<section style="background-image: url(granularity.jpg)">
    <h1>granularidade</h1>
    <p>abstra√ß√µes acontecem em v√°rios n√≠veis, mas o potencial √© proporcional √† escala</p>
</section>

<section>
    <h1>profunda</h1>
    <ul>
    <li>ortogonal</li>
    <li>compos√≠vel</li>
    <li>complexidade adicionada < complexidade abstra√≠da</li>
    <h1>interface enxuta</h1>
    </ul>
    <ul>
    <li>padr√µes razo√°veis</li>
    <li>estado m√≠nimo e expl√≠cito</li>
    <li>pr√©-condi√ß√µes + invariantes + p√≥s-condi√ß√µes</li>
    <li>intui sua implementa√ß√£o</li>
    </ul>
</section>

<section>
    <header>
        <p>profunda</p>
    </header>

    <h1>ortogonal</h1>
</section>

<section>
    <header>
        <p>profunda</p>
    </header>

    <h1>compos√≠vel</h1>
</section>

<section>
    <header>
        <p>profunda</p>
    </header>

    <h1>complexidade adicionada < complexidade abstra√≠da</h1>
</section>

<section>
    <header>
        <p>profunda</p>
    </header>

    <p>complexidade adicionada < complexidade abstra√≠da</p>
    <h1>desempenho</h1>
    <ul>
    <li>√© um sistema pervasivo? muitas entidades?</li>
    <li>onde h√° um, h√° muitos! qual o caso comum? operar em lotes!</li>
    <li>agrupar por tipos ao inv√©s de cole√ß√µes heterog√™neas</li>
    <li>particionar ao inv√©s de branch</li>
    <li>multithread? job system?</li>
    </ul>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <h1>padr√µes razo√°veis</h1>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>padr√µes razo√°veis</p>
    <h1>estruturas de dados</h1>
    <p>arrays <em>muito</em> provavelmente s√£o suficientes</p>
    <p>processadores adoram mem√≥ria linear</p>
    <p>*olha feio praquela lista encadeada* üò†</p>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <h1>estado m√≠nimo e expl√≠cito</h1>
    <p>sobre quais os dados a api opera?</p>
    <p>onde eles s√£o alterados?</p>

    <footer>
        <p><a href="https://www.gamedeveloper.com/programming/in-depth-functional-programming-in-c-">in detph: functional programming in c++</a></p>
    </footer>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>estado m√≠nimo e expl√≠cito</p>
    <h1>const correctness</h1>
    <p>preferir estilo funcional sempre que poss√≠vel</p>
    <p>facilita compreens√£o. menos dependente de ordem de execu√ß√£o</p>
    <pre><code>// evitar
obj.CheckSomething();
obj.MaybeDoSomethingInResponse();

// preferir
var result = obj.CheckSomething();
if (result) {
    obj.DoSomethingInResponse(result);
}</code></pre>

    <footer>
        <p><a href="https://isocpp.org/wiki/faq/const-correctness">c++ const correctness</a></p>
    </footer>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>estado m√≠nimo e expl√≠cito</p>
    <h1>recursos e posse</h1>
    <p>quem √© o respons√°vel pelo recurso?</p>
    <p>posse vs empr√©stimo</p>
    <p>onde h√° aloca√ß√£o de mem√≥ria? poss√≠vel evit√°-la?</p>
    <ul>
    <li>c# = preferir structs e arrays; reusar cole√ß√µes</li>
    <li>c++ = arrays; inline allocator;</li>
    </ul>

    <footer>
        <p><a href="https://docs.microsoft.com/en-us/dotnet/standard/memory-and-spans/memory-t-usage-guidelines#owners-consumers-and-lifetime-management">c# memory and spans - owners, consumers and lifetime management</a></p>
        <p><a href="https://github.com/dotnet/runtime/blob/main/src/libraries/System.Private.CoreLib/src/System/Collections/Generic/List.cs#L25">List.cs</a></p>
        <p><a href="https://docs.unrealengine.com/5.0/en-US/API/Runtime/Core/Containers/TInlineAllocator/">TInlineAllocator</a></p>
    </footer>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <h1>pr√©-condi√ß√µes + invariantes + p√≥s-condi√ß√µes</h1>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>pr√©-condi√ß√µes + invariantes + p√≥s-condi√ß√µes</p>
    <h1>null</h1>
    <p>pr√©-condi√ß√£o: quais fun√ß√µes podem <em>receber</em> null?</p>
    <p>p√≥s-condi√ß√£o: quais fun√ß√µes podem <em>retornar</em> null?</p>
    <p>decidir e ser expl√≠cito!</p>
    <p>linguagens mais recentes t√™m esse conceito embutido (rust, zig, kotlin, c#8)</p>
    <ul>
    <li>c# da unity n√£o tem isso</li>
    <li>bitstrap: <code>Option<T></code></li>
    </ul>

    <footer>
        <p><a href="https://github.com/bitcake/bitstrap/blob/master/Assets/Runtime/Functional/Option.cs">Option.cs</a></p>
    </footer>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>pr√©-condi√ß√µes + invariantes + p√≥s-condi√ß√µes</p>
    <h1>minimizar erros</h1>
    <p>dois tipos de erros:</p>
    <ul>
    <li>entrada/sa√≠da => tratar</li>
    <li>l√≥gica => assert</li>
    </ul>

    <footer>
        <p>"define errors out of existence" -- ousterhout, john</p>
    </footer>
</section>

<section>
    <h2>intervalo de valores</h2>
    <p>usar tipos para codificar valores v√°lidos</p>
    <pre><code>// evitar
int GetPlayerCount();

// preferir
uint8 GetPlayerCount();</code></pre>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <h1>intui sua implementa√ß√£o</h1>
    <p>a partir de uma transforma√ß√£o conhecida, √© poss√≠vel inferir aproximadamente suas entradas e sa√≠das</p>
</section>

<section>
    <header>
        <p>interface enxuta</p>
    </header>

    <p>intui sua implementa√ß√£o</p>
    <h1>debugabilidade</h1>
    <ul>
    <li>onde est√£o os dados?</li>
    <li>s√£o f√°ceis de inspecionar?</li>
    <li>√© f√°cil acompanhar o que est√° acontecendo pelo debugger?</li>
    </ul>
</section>

<section style="background-image: url(galaxy-brain.png)">
    <h1>√†s vezes n√£o precisa de api ou abstra√ß√£o</h1>
    <h2>c√≥digo vai, design fica</h2>
</section>

<section class="main">
    <h1>3 big lies</h1>
    <ul>
    <li>software is a platform</li>
    <li>code should be designed around a model of the world</li>
    <li>code is more important than data</li>
    </ul>

    <footer>
        <p><a href="https://cellperformance.beyond3d.com/articles/2008/03/three-big-lies.html">three big lies</a></p>
    </footer>
</section>

<section>
    <h1>late binding x early binding</h1>
    <p>no in√≠cio, queremos simplicidade</p>
    <p>no final, queremos controle total</p>
</section>

<section>
    <h1>design de api = ponderar custo-benef√≠cios</h1>
    <p>"everything should be made as simple as possible, but not simpler."</p>
    <p>-- einstein, albert (supostamente)</p>

    <footer>
        <p>valeu! falou! :)</p>
    </footer>
</section>

</body>
</html>
